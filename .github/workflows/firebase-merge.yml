name: Deploy Everything To Firebase
on:
  push:
    branches:
      - main

jobs:
  build_and_deploy_all:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Code
        uses: actions/checkout@v4

      # 1. Build the Frontend (Vite)
      - name: Build Frontend
        run: |
          cd frontend
          npm ci
          npm run build

      # 2. Build the Backend (Cloud Functions)
      # Note: If your functions are pure JS and don't need a build step, 
      # you can remove the 'npm run build' line here.
      - name: Build Functions
        run: |
          cd functions
          npm ci
          npm run build

      # 3. Authenticate with Google Cloud using your existing secret
      - name: Authenticate to Google Cloud
        uses: google-github-actions/auth@v2
        with:
          credentials_json: ${{ secrets.FIREBASE_SERVICE_ACCOUNT_WILLHABEN_ADVANCED_AGENT }}

      # 4. Install the Firebase CLI and Deploy Everything
      - name: Deploy to Firebase
        run: |
          npm install -g firebase-tools
          firebase deploy --project willhaben-advanced-agent --non-interactive